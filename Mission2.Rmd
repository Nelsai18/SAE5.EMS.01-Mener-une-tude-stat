---
title: "deploiement IRVE"
author: "zarafa"
date: "2025-11-3"
output: html_document
---
# ANALYSE DU DÉPLOIEMENT DE L'INFRASTRUCTURE DE RECHARGE (IRVE)
library(tidyverse)
library(lubridate)
library(scales)
library(leaflet)
library(RColorBrewer)
library(viridis)
```

```{r}
bornes <- read_csv("U:/Documents/BUT3/SAE_mener_une etude_stat/consolidation-etalab-schema-irve-statique-v-2.3.1-20251116.csv")
SEPARATEUR_CSV <- ";"                           
DECIMAL_CSV <- ","

```
#Nettoyage et préparation
```{r}
bornes_clean <- bornes %>%
mutate(
consolidated_latitude = as.numeric(str_replace_all(consolidated_latitude, "," , ".")),
consolidated_longitude = as.numeric(str_replace_all(consolidated_longitude, "," , ".")),
date_mise_en_service = as.Date(date_mise_en_service),
annee = year(date_mise_en_service),
annee_mois = floor_date(date_mise_en_service, "month"),
trimestre = paste0(year(date_mise_en_service), "-T", quarter(date_mise_en_service)),
categorie_puissance = case_when(
puissance_nominale >= 150 ~ "Très Rapide (≥150 kW)",
puissance_nominale >= 50  ~ "Rapide (50-149 kW)",
puissance_nominale >= 22  ~ "Accélérée (22-49 kW)",
puissance_nominale >= 7   ~ "Normale (7-21 kW)",
puissance_nominale > 0    ~ "Lente (<7 kW)",
TRUE ~ "non renseignée"
)
) %>%
filter(
annee >= 2015 & annee <= 2020,
nbre_pdc > 0,
!is.na(puissance_nominale),
!is.na(consolidated_latitude),
!is.na(consolidated_longitude)
)

```

#Évolution cumulative
```{r}
evolution_cumulative <- bornes_clean %>%
arrange(date_mise_en_service) %>%
group_by(annee_mois) %>%
summarise(
pdc_mensuels = sum(nbre_pdc, na.rm = TRUE),
stations_mensuelles = n_distinct(id_station_itinerance)
) %>%
ungroup() %>%
mutate(
pdc_cumules = cumsum(pdc_mensuels),
stations_cumulees = cumsum(stations_mensuelles)
)

```
#visualisation
```{r}
ggplot(evolution_cumulative, aes(annee_mois, pdc_cumules)) +
geom_line(color = "#2E86AB", linewidth = 1.2) +
geom_point(data = subset(evolution_cumulative, annee_mois == max(annee_mois)),
color = "#E74C3C", size = 3) +
geom_text(
data = subset(evolution_cumulative, annee_mois == max(annee_mois)),
aes(label = paste0("2020: ", comma(pdc_cumules), " PDC")),
vjust = -1, size = 5, fontface = "bold", color = "#E74C3C"
) +
scale_y_continuous(labels = comma_format()) +
scale_x_date(date_breaks = "1 year", date_labels = "%Y",
limits = c(as.Date("2015-01-01"), as.Date("2020-12-31"))) +
labs(
title = "Évolution cumulative des points de charge (2015–2020)",
x = "Année", y = "PDC cumulés"
) +
theme_minimal()

```

#Évolution annuelle
```{r}
evolution_annuelle <- bornes_clean %>%
group_by(annee) %>%
summarise(pdc_annuels = sum(nbre_pdc)) %>%
mutate(croissance_pct = (pdc_annuels / lag(pdc_annuels) - 1) * 100)

ggplot(evolution_annuelle, aes(factor(annee), pdc_annuels)) +
geom_col(fill = "#3498DB", alpha = 0.8) +
geom_text(aes(label = comma(pdc_annuels)), vjust = -0.5) +
geom_line(aes(y = pdc_annuels, group = 1),
color = "#E74C3C", linewidth = 1, linetype = "dashed") +
scale_y_continuous(labels = comma_format()) +
labs(
title = "Déploiement annuel des points de charge (2015–2020)",
x = "Année", y = "Nombre de PDC"
) +
theme_minimal()

```
#Répartition des puissances (2020)

```{r}
repartition_2020 <- bornes_clean %>%
filter(annee == 2020) %>%
group_by(categorie_puissance) %>%
summarise(total_pdc = sum(nbre_pdc)) %>%
mutate(
pourcentage = total_pdc / sum(total_pdc) * 100,
label = paste0(round(pourcentage, 1), "%")
)

ggplot(repartition_2020, aes(fct_reorder(categorie_puissance, pourcentage),
pourcentage, fill = categorie_puissance)) +
geom_col() +
geom_text(aes(label = label), hjust = -0.1) +
coord_flip() +
scale_fill_brewer(palette = "Set2") +
labs(
title = "Répartition des PDC par puissance – 2020",
x = "Catégorie", y = "Pourcentage"
) +
theme_minimal() +
theme(legend.position = "none")

```

#Évolution par puissance
```{r}
evolution_puissance <- bornes_clean %>%
group_by(annee, categorie_puissance) %>%
summarise(total_pdc = sum(nbre_pdc))

ggplot(evolution_puissance, aes(annee, total_pdc, fill = categorie_puissance)) +
geom_area(alpha = 0.8) +
scale_fill_brewer(palette = "Set2") +
labs(
title = "Évolution du parc par type de puissance (2015–2020)",
x = "Année", y = "PDC"
) +
theme_minimal()

```
#Aménageurs
```{r}
top_amenageurs <- bornes_clean %>%
count(nom_amenageur, sort = TRUE) %>%
head(10) %>%
mutate(nom_amenageur = fct_reorder(nom_amenageur, n))

ggplot(top_amenageurs, aes(nom_amenageur, n)) +
geom_col(fill = "#27AE60", alpha = 0.8) +
coord_flip() +
labs(
title = "Top 10 des aménageurs (2015–2020)",
x = "Aménageur", y = "Nombre de PDC"
) +
theme_minimal()

```

#Carte – Répartition par puissance
```{r}
carte_puissance <- bornes_clean %>%
filter(annee == 2020) %>%
sample_n(min(1000, nrow(.)))

pal_puissance <- colorFactor("blue", domain = carte_puissance$categorie_puissance)

leaflet(carte_puissance) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircleMarkers(
lng = ~consolidated_longitude, lat = ~consolidated_latitude,
radius = 5, fillOpacity = 0.8, stroke = FALSE,
color = ~pal_puissance(categorie_puissance)
) %>%
addLegend(pal = pal_puissance, values = ~categorie_puissance, title = "Puissance")

```

#Carte – Aménageurs
```{r}
top_amg <- bornes_clean %>% count(nom_amenageur, sort = TRUE) %>% head(5) %>% pull(nom_amenageur)

carte_amg <- bornes_clean %>%
filter(annee == 2020) %>%
sample_n(min(1000, nrow(.))) %>%
mutate(categorie_amenageur = ifelse(nom_amenageur %in% top_amg, nom_amenageur, "Autres"))

pal_amg <- colorFactor("orange", domain = carte_amg$categorie_amenageur)

leaflet(carte_amg) %>%
addProviderTiles("CartoDB.Positron") %>%
addCircleMarkers(
lng = ~consolidated_longitude, lat = ~consolidated_latitude,
radius = 5, fillOpacity = 0.8, stroke = FALSE,
color = ~pal_amg(categorie_amenageur)
) %>%
addLegend(pal = pal_amg, values = ~categorie_amenageur, title = "Aménageurs")

```


```{r}
# RÉPARTITION PAR TYPE DE PRISE
carte_prises <- bornes_clean %>%
  filter(annee == 2020) %>%
  sample_n(min(1000, nrow(.))) %>%
  mutate(type_prise = "Type 2") # Simplification garantie
pal_prises <- colorFactor("red", domain = carte_prises$type_prise)
leaflet(carte_prises) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addCircleMarkers(
    lng = ~consolidated_longitude, lat = ~consolidated_latitude, radius = 5,
    color = ~pal_prises(type_prise), fillOpacity = 0.8, stroke = FALSE,
    popup = ~paste0("<b>", nom_amenageur, "</b><br>PDC: ", nbre_pdc)
  ) %>%
  addLegend(pal = pal_prises, values = ~type_prise, title = "Type de Prise")
```

-------------------------------------#----------------------------------------------------------







